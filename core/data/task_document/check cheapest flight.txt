name: Find cheapest viable flight options
description: Identify and summarize the lowest-priced reasonable flight itineraries given user constraints.

goal/outcome:
  - Confirmed itinerary inputs (origin, destination, dates/range, passenger count) and key constraints (cabin, nonstop, luggage, budget).
  - At least one vetted lowest-cost option and one reasonable alternative with carrier, timing, layovers, baggage/fee notes, and currency context.
  - Transparent source references (OTA/airline/search) and clear caveats about price volatility or missing data.
  - User-facing summary with next-step offer to refine or proceed.

inputs_params:
  - Required: Origin and destination airports/cities; travel dates or flexible window; passenger count.
  - Optional: Cabin class, nonstop preference, time-of-day window, luggage needs, seat selection needs, budget cap, acceptable layover count/length, currency/locale.

context:
    reasoning:
      - Confirm inputs once to avoid searching wrong routes or dates.
      - Select sources that show total cost and baggage info; prefer official airline/OTA data.
      - Capture tradeoffs (layover length, overnight segments) so cheapest options are still practical.
      - Normalize currency and timestamp results; flag volatility and assumptions.
    deadline: {time remaining} left until deadline {deadline in absolute time format}
    definition_of_done(check during final validation step):
      - Inputs captured/confirmed; search performed in requested scope.
      - Cheapest and one alternative option listed with price, currency, carrier, timings, layovers, baggage/fee notes, and source.
      - Constraints respected (nonstop/cabin/date) or exceptions clearly flagged.
      - Summary ready for user with refinement invitation.
    avoid:
      - Using unrelated airports/dates or stale prices without flagging.
      - Ignoring baggage/seat costs when they materially change totals.
      - Suggesting impractical itineraries (extreme layovers) without warnings.

steps:
    name: Confirm travel parameters
    description: Gather and restate all required itinerary inputs and preferences before searching.
    action_instruction: Collect origin/destination (airport/city codes), travel dates or flexibility, passenger count, and constraints (cabin, nonstop, budget, luggage/seat needs, time windows). If anything critical is missing, ask once for clarification, then restate the assumptions and confirmed inputs back to the user before proceeding.
    validation_instruction: Ensure all required fields are present and coherent (e.g., return date after departure, cities not identical unless one-way). If inconsistencies exist, resolve them or note assumptions explicitly.

    name: Plan search approach
    description: Choose sources and tools that will provide usable pricing with baggage context.
    action_instruction: Decide specific sources (airline sites, trusted OTAs, meta-search) and actions (browser/search or HTTP requests) based on route and region. Prefer sources with total fare visibility and baggage details; note currency/locale expectations. Document planned sources before execution.
    validation_instruction: Verify chosen sources cover the route/dates and support the currency/locale. Adjust plan if coverage is weak or if only partial info (e.g., no baggage data) is available.

    name: Retrieve pricing options
    description: Execute the search and capture candidate itineraries with supporting details.
    action_instruction: Run the selected lookups, capturing carrier, flight numbers when available, departure/arrival times, duration, layovers, and total price. Note baggage/seat fees if shown; otherwise, state assumptions. Keep timestamps and source identifiers.
    validation_instruction: Confirm results match requested dates and airports. Discard mismatched or stale entries. If no results, expand slightly within user-approved flexibility and log the attempt.

    name: Compare and select candidates
    description: Identify the lowest-cost and best-value options that satisfy constraints.
    action_instruction: Sort by total expected cost (fare plus known/likely baggage/seat fees). Highlight tradeoffs such as long or overnight layovers. Select at least one cheapest option and one alternative with better convenience if price gap is reasonable.
    validation_instruction: Check selected options align with user constraints (nonstop, cabin, time windows, layover tolerance). Remove any violating itineraries and ensure pricing still reflects total expected costs.

    name: Validate overall results
    description: Ensure outputs meet definition of done before sharing.
    action_instruction: Confirm that pricing data is sourced, currencies noted, and constraints addressed or flagged. Verify that at least one cheapest and one alternative option are ready with timings, layovers, baggage notes, and sources. Prepare concise bullet-ready facts for the summary.

    name: Report findings and close
    description: Deliver results, capture next steps, and finalize the task.
    action_instruction: Send user a summary covering route, dates, passenger count, cheapest and alternative options with price/currency, carrier, times, layovers, baggage/fee context, and sources. State assumptions/volatility, offer refinements, and then mark the task completed. Clean up any temp notes or files if created.
