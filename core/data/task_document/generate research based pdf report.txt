name: Generate a research-based PDF report and save it in the workspace
description: The agent is instructed to perform an online search and gather accurate, up-to-date information on a given topic. Using this data, the agent must generate a comprehensive, well-structured report in PDF format and save it to the workspace.

goal/outcome:
  - A completed, professional-grade PDF report on the specified research topic.
  - The PDF must be clearly structured with title, sections, citations, and summary.
  - Information is accurate, up-to-date, and properly sourced.
  - The final report is saved in the workspace as {file name}.
  - A delivery message summarizes the research scope, methods, and assumptions.
  - An audit note is recorded.

inputs_params:
  - Topic or query for research.
  - User-specified focus areas, keywords, or subtopics.
  - Desired output file name and format (default: {topic}.pdf).
  - Citation/formatting style.
  - Optional max pages or word count.

context:
  reasoning:
    - Perform online searches in a single step.
    - Perform all the research in a single step
    - Collect ALL search result files first.
    - DO NOT summarize yet.
    - Once all research files exist, begin cleanup.
    - Summarize using actions only.
    - Build the draft using action only.
    - Generate and validate the PDF using action only.
    - Deliver and clean up.
    - TRY to use pre-existing actions as much as possible
    - TRY to stick to these steps as much as possible
  deadline: {time_left} left until deadline {deadline}
  definition_of_done:
    - All sections complete.
    - Factually correct and sourced.
    - Clean structure and PDF integrity.
    - Final file saved under correct name.
    - Summary message delivered.
    - Cleanup completed.

avoid:
  - Outdated or unverifiable information.
  - Empty or incomplete sections.
  - LLM summarization during cleanup.
  - LLM for making draft
  - LLM for converting to PDF
  - Generating filler content.
  - Moving to cleanup before ALL research is collected.
  - DO NOT spend more than 10 minutes on research

steps:
    name: Define research topic
    description: Confirm topic and scope of research.
    action_instruction: Ask user to specify topic if too broad, confirm or refine topic, focus areas, and preferences.
    validation_instruction: Ensure the topic and parameters are confirmed.

    name: Conduct online research
    description: Perform online searche and store raw results.
    action_instruction: |
      - Use 'batch google search' action for each query needed with pdf=true.
      - DO NOT summarize anything yet.
    validation_instruction: Ensure sources are reliable and raw files correctly saved.

    name: Confirm research aggregation is complete
    description: Ensure all searches and file saves are done before cleanup.
    action_instruction: |
      - Inspect the temporary task folder.
      - Verify that all expected raw result files exist.
      - If any expected data is missing, perform additional searches.
      - Only proceed once the research dataset is fully collected.
    validation_instruction: No cleanup allowed until the folder is complete.

    name: Cleanup Content (IMPORTANT)
    description: Summarize all content in the temporary file generated by research and make it PDF ready.
    action_instruction: |
      - Use the temporary file created by the previous step
      - Read the data from the temporary file
      - Use LLM to summarize the content and format it in MD format ready to be converted into a PDF
      - DO NOT create a script, just ask the model to clean the content and provide content in prompt
      - Save the MD file in the workspace and use it in the next step
    validation_instruction: MD file exists

    name: Generate PDF file
    description: Convert the content inside the final draft into formatted PDF.
    action_instruction: |
      - Read content from the final converted MD file and then use 'convert to pdf' with the required formatting rules.
      - ONLY use the final md file available locally
      - DO NOT use the LLM to generate any new content
    validation_instruction: Open and verify PDF integrity.

    name: Validate and review report
    description: Check citations, accuracy, formatting.
    action_instruction: Review content and confirm correctness.
    validation_instruction: Ensure final quality and readability.

    name: Deliver report to user
    description: Send PDF and summary.
    action_instruction: Use ‘send message with attachment’.
    validation_instruction: Ensure correct file delivered.

    name: Close task session and cleanup
    description: Delete temporary data and finalize audit records.
    action_instruction: Record completion and remove tmp files.
    validation_instruction: Workspace is clean and task closed.